\let\textcircled=\pgftextcircled
\chapter{The LHC and the CMS experiment}
\label{chap:detector}

\initial{T}his chapter concerns the experimental setup. The \acrlong{lhc} provides the \acrshort{cms} experiment with proton-proton collision data that is then stored, corrected, and then used by physicists for various analyses from \acrlong{sm} precision measurements, searches for new physics, the development of tools and algorithms to aid the previous two, and much more.

\begin{easylist}[itemize]
\ListProperties(Style*=-- , FinalMark={)}, Margin=0.5cm)
& Explain \acrshort{cern} and the \acrshort{lhc} in more detail.
& Give an overview of the \acrshort{cms} experiment and detector (including all subsystems, object identification, algorithms for event/object reconstruction like Particle Flow and \gls{antikt}, and algorithms for tagging objects like \glspl{bjet}). Explain geometry as well ($\phi$, $\eta$ -- with a description (angle between particle/object and beam axis) and equation, also noting the boundaries between barrel, end cap and HF).
& As a subsection in this chapter, discuss the Level-1 Trigger in depth. Emphasise the jet and energy sum triggers as I've worked on them, and Calorimeter Layer-2 for the same reason. Tie into SVJ and Hinv since they're hadronic searches.
\end{easylist}


%=========================================================


\section{The Large Hadron Collider}
\label{sec:detector_lhc}

Deep underground beneath the Franco-Swiss border lies the \acrfull{lhc}, a synchrotron particle accelerator 27\,km in circumference. As the largest machine in the world, the \acrshort{lhc} stands as a testament to the importance of fundamental science and the dedication to which it is pursued. Predominantly a proton collider, lead and xenon ions have also been injected for novel and unique studies. Four principle experiments are situated at their own interaction points where the two beams of particles are brought into contact: \acrshort{cms} (\acrlong{cms}), a general purpose detector with interests in precision measurements, searches for new physics, and many other avenues; \acrshort{atlas} (\acrlong{atlas}), another general purpose detector with similar aims to \acrshort{cms}; LHCb, designed to study the decay of \PB hadrons; and \acrshort{alice} (\acrlong{alice}), primarily studying heavy ion collisions and the quark-gluon plasma.


%=========================================================


\subsection{A proton's journey}
\label{subsec:protons_journey}

A proton begins its journey as a hydrogen atom in a little, red bottle. Around 10$^{\text{14}}$ protons are supplied to each beam in the \acrshort{lhc}, with billions of refills available in this single container. Once the hydrogen atoms leave the source, they are stripped of their electrons, and [sent] to the linear accelerator LINAC2. This is the start of a long voyage through the accelerator complex (visualised in Fig.~\ref{fig:cern_accelerator_complex}).

Given a modest boost to 50\,\acrshort{mev} (\acrlong{mev}s), the protons are sequentially fed from LINAC2 into the \acrfull{psb} that accelerates them further to 1.4\GeV. Another upsurge is provided once the protons travel to the \acrfull{ps}, this time to 26\GeV. Then the final energy increase received before entering the \acrshort{lhc} comes from the \acrfull{sps}, leaving the protons at 450\GeV. Once injected into the \acrshort{lhc}, they are finally accelerated to their peak energy of up to 6.5\TeV from a sequence of radio frequency cavities over the course of twenty minutes. The oscillation frequency of these cavities is precisely tuned and timed to give protons the appropriate kicks and accelerate them to the desired energy. Since there is a distribution of proton energies in the beam, those that enter a cavity slightly out of time with a different energy than expected consequently become sorted into ``bunches''. The remainder of the \acrshort{lhc} ring is used to steer the beam with the aid of over 1,200 liquid helium-cooled superconducting dipole magnets. It is also focused by almost 400 equivalently-cooled quadrupole magnets to increase the rate of proton collisions.

One beam consists of a ``train'' of up to 2,808 bunches spaced 25\,ns apart, each with 115 billion protons. Using bunches provides an advantage to the experiments at each of the interaction points. Discrete collisions take place between bunches in the opposing beams at 40\,MHz as opposed to an almost continuous stream of protons. This allows for estimates of multiple interactions per bunch crossing (known as \emph{\gls{pileup}}) that can be filtered out, and would otherwise introduce miscalculations of sums like \ptmiss and \HT. Each proton-proton collision is colloquially known as an ``event'', with data recorded by each experiment separated into events.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/CERN_accelerator_complex.jpg}
    \caption[A schematic of the \acrshort{cern} accelerator complex]{A schematic of the \acrshort{cern} accelerator complex. Various particles are shown from their sources to the detectors they are observed at. Figure obtained from Ref.~\citenum{cern_accelerator_complex_page}.}
    \label{fig:cern_accelerator_complex}
\end{figure}

% Describe the structure of the LHC - beam pipe, cooling. Include a couple more stats somewhere (operating/electricity power draw)? Can look in Postgraduate and CMS courses/ folder. Reference the technical design report of the LHC (\cite{lhc_design_report} 


%=========================================================


\subsection{Luminosity}
\label{subsec:luminosity}

The \emph{luminosity} of a particle accelerator is, along with centre of mass energy, a quantitative measure of its performance. It also often used to denote the amount of data delivered, or the data collected by the receiving detector. A full derivation of this quantity can be found in Ref.~\citenum{Herr:941318}, and as such, a summary is given here. The \emph{instantaneous luminosity} $\mathcal{L}$, typically quoted in $\text{cm}^{-2}\text{s}^{-1}$, is defined as

\begin{equation}
    \mathcal{L} = \frac{1}{\sigma_{\mathrm{p}}} \frac{\mathrm{d}N}{\mathrm{d}t}
    \label{eq:lumi_instantaneous}
\end{equation}

where $N$ is the number of collisions and $\sigma_{\mathrm{p}}$ is the production cross section. In the \acrshort{lhc}, since many final states are possible, $\sigma_{\mathrm{p}}$ is not generally known. For two colliding beams split into bunches with the constituents in each bunch distributed according to a gaussian profile,

\begin{equation}
    \mathcal{L} = \frac{N_1 N_2 f N_b}{4 \pi \sigma_x \sigma_y} \cdot F % \cdot H
    \label{eq:lumi_inst_head_on_colliding_beams}
\end{equation}

where $N_1$ and $N_2$ are the number of particles in a bunch in beams 1 and 2, respectively, $N_b$ is the number of bunches in a beam, $f$ is the revolution frequency (11,245\,Hz for protons in the LHC), and $\sigma_x$ and $\sigma_y$ are the horizontal and vertical sizes of the beam, respectively.

The geometric reduction factor $F$ is unity for beams colliding head on. However, in the \acrshort{lhc}, the beams collide at an angle known as the ``crossing angle'' to reduce the effects of pileup. At the start of a fill when the number of protons in the \acrshort{lhc} is at its maximum, the crossing angle at each interaction point is approximately 300\,\si{\micro\text{rad}}. As the runs progress, more protons collide and the luminosity decreases. One of measures taken to recover luminosity and keep the \acrshort{lhc} as efficient as possible is to reduce the crossing angle. By the end of the fill, it can be as small as 240\,\si{\micro\text{rad}}.

% Add mathematical formula for F (see https://espace.cern.ch/DG-DAT/public/Springer_Volume%20I21C/9_Lamont/luminosity/Luminosity%20Optimization.pdf)? Also, uncomment H factor from the hourglass effect and explain?

The instantaneous luminosity can be increased by the inclusion of more bunches in the beam, decreasing the size of the beam through improved quadrupole magnets, and by reducing the crossing angle. Tuning these parameters led the \acrshort{lhc} to reach is design luminosity of 10$^{34}\text{cm}^{-2}\text{s}^{-1}$ in 2016. It had more than doubled by the end of Run-2.

Integrating the the instantaneous luminosity over a period of time yields the \emph{integrated luminosity} $\mathcal{L}_{\mathrm{int.}}$:

\begin{equation}
    \mathcal{L}_{\mathrm{int.}} = \int \mathcal{L} \ \mathrm{d}t
    \label{eq:lumi_integrated}
\end{equation}

These values are often quoted by experiments in units of ``inverse femtobarn'' (\fbinv) as an indicator of the amount of collision data collected. A ``barn'' is a unit equal to 10$^{-28}$\,m$^2$ and colloquially used to express cross sectional area in nuclear and particle physics. As such its reciprocal, the same units as integrated luminosity gives a good sense of scale that relates cross sections of individual processes to the total amount of data. Tab.~\ref{tab:lumis_lhc_cms} gives the integrated luminosities over Run-2 delivered by the LHC and collected by CMS.


%=========================================================


\subsection{Evolution of the LHC}
\label{subsec:evolution_lhc}

% Talk about some of the upgrades, maybe to the magnets and stuff which allowed the c.o.m. to be increased, and stuff. Might also want to mention design energy and luminosity (that we aren't quite at design energy - but might hit it for Run-3).

The \acrshort{lhc} began operating in 2010 at a centre of mass energy of $\sqrt{s} = \text{7}\TeV$ (\acrlong{tev}s), 3.5\TeV per beam. A modest increase to 8\TeV was achieved by the end of Run-1 in 2013. After upgrades were performed, the LHC resumed operation in 2015, further pushing the frontiers of high energy physics with a centre of mass energy of \comruntwo. While valuable data was taken, it was not until 2016 when Run-2 of the \acrshort{lhc} began. This period ended in 2018 with 158.64\fbinv of $\Pp\Pp$ collisions delivered, 146.45\fbinv of which were recorded by \acrshort{cms} who certified 137.19\fbinv suitable for analysis~\cite{cmslumitwikipage,cmslumipogpage}. A breakdown by year is presented in Tab.~\ref{tab:lumis_lhc_cms}.

\begin{table}[htbp]
    \centering
    \begin{tabular}{lcccc}
        \hline
        Integrated luminosity & 2016 & 2017 & 2018 & Full Run-2 \\\hline
        Delivered by LHC (\fbinv) & 40.99 & 49.79 & 67.86 & 158.64 \\
        Recorded by CMS (\fbinv) & 37.80 & 44.98 & 63.67 & 146.45 \\
        Certified by CMS (\fbinv) & 35.92 & 41.53 & 59.74 & 137.19 \\
        \hline
    \end{tabular}
    \caption[The integrated luminosity delivered by the LHC during Run-2 which were recorded and certified by CMS]{The integrated luminosity delivered by the LHC during Run-2 which were recorded and certified by CMS. Numbers obtained from Refs.~\citenum{cmslumitwikipage,cmslumipogpage}.}
    \label{tab:lumis_lhc_cms}
\end{table}


%=========================================================


\section{The CMS experiment}
\label{sec:detector_cms}

% Can look in Postgraduate and CMS courses/ folder. Reference letter of intent \cite{DellaNegra:290808} and probably some TDRs as well (search at https://cds.cern.ch/collection/CMS%20Reports?ln=en)
% In this bit, give a short introduction to the CMS experiment (when it started, number of collaborators, what kind of physics is done) before talking specifically about the detector and stuff.

%=========================================================


\subsection{The CMS detector}
\label{subsec:cms_detector_itself}

% Talk about the design of the detector and the principal components/subsystems. Give some numbers and stats (solenoid contains more energy than any other magnet in the world, etc). Explain geometry as well ($\phi$, $\eta$ -- with a description (angle between particle/object and beam axis) and equation, also noting the boundaries between barrel, end cap and HF). Maybe mention the upgrades done between Run-1 and Run-2, and possibly even the planned upgrades for Run-3 and Phase-2.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.9\textwidth]{figures/cms_160312_06.pdf}
    \caption[A cutaway diagram of the CMS detector with all of the principal components labelled. This detector configuration was used for the 2017--18 data taking years]{A cutaway diagram of the CMS detector with all of the principal components labelled. This detector configuration was used for the 2017--18 data taking years, where the coverage of the pixel detectors in the silicon tracker were upgraded from 1\,m$^2$ (66 million channels) to 1.9\,m$^2$ (124 million channels). Image taken from Ref.~\citenum{Sakuma:2665537}.}
    \label{fig:detector_cms_cutaway}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.75\textwidth]{figures/Transverse_slice_CMS.png}
    \caption[A transverse slice through the CMS detector with the main subsystems and components visible]{A transverse slice through the CMS detector with the main subsystems and components visible (figure obtained from Ref.~\citenum{CMS-PRF-14-001}). Several particles produced at the primary vertex and their interactions with the detector are also depicted.}
    \label{fig:detector_cms_transverse}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.75\textwidth]{figures/int_lumi_cumulative_pp_2_run2.pdf}
    \caption[The integrated luminosity of $\Pp\Pp$ collision data delivered to CMS during 2015 and Run-2 of the LHC]{The integrated luminosity of $\Pp\Pp$ collision data collected by CMS during 2015 and Run-2 of the LHC. Figure obtained from Ref.~\citenum{cmslumitwikipage}.}
    \label{fig:detector_cms_lumi}
\end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.75\textwidth]{figures/pileup_allYears_run2.pdf}
    \caption[The average number of pileup interactions at CMS during 2015 and Run-2 of the LHC]{The average number of pileup interactions at CMS during 2015 and Run-2 of the LHC. Figure obtained from Ref.~\citenum{cmslumitwikipage}.}
    \label{fig:detector_cms_pileup}
\end{figure}


%=========================================================


\subsection{Recording data for analysis}
\label{subsec:cms_recording_data}

% Talk about the different stages of data recording, from the Level-1 and High Level Trigger (and how they work with hardware/software), object identification, Particle Flow, anti-kt, any corrections and stuff applied, and how the data tiers work (AOD, miniAOD, nanoAOD, etc., which might require a small segue into ROOT and how we use it).


%=========================================================


\subsection{Jet energy corrections in the Level-1 Trigger}
\label{subsubsec:detector_jecs}

% Taken directly from second year report. Tidy up and improve. Can also look in Section 20 of my lab book for more info. Define what eta is, somewhere (can take from Section 14 of lab book)
\Gls{jec} are necessary to compensate for various losses when recording jet properties in the trigger. These losses depend on the transverse momentum \pt and pseudorapidity $\eta$. The calibrations ensure that the performance of the trigger is uniform across the detector. Firstly, some ideal (or reference) jets are needed to compare against given L1 jets. Since Monte Carlo datasets are used for the calibrations, the reference jets we use are the generator-level jets (or GenJets). These are stable, simulated particles clustered with the \gls{antikt} algorithm~\cite{Cacciari:2008gp} to form the jet. The state of these jets are post-hadronisation, before detector interaction. L1 jets need to be matched against the GenJets. From there, various studies can be performed such measuring the response of the detector $\langle \ptsup{{\mathrm{L1}}} / \ptsup{{\mathrm{ref.}}} \rangle$, and its position and energy resolutions.

Once Calorimeter Layer-1 experts have derived scale factors for the physics objects, they are applied in Layer-2 where the calibrations are conducted. For jets, ntuples are created from the specified dataset and the L1 jets are matched to the GenJets using the variable $\Delta R$: 

\begin{equation}
\Delta R = \sqrt{\Delta \eta^2 + \Delta \phi^2}
\label{eq:delta_r}
\end{equation}

where $\phi$ is the azimuthal angle of the jet. The algorithm used to match the jets does so by inspecting each L1 jet in descending \pt and searching for a reference jet with $\Delta R < 0.25$. If there is more than one match, the reference jet with the smallest $\Delta R$ is taken. Then the next L1 jet (and so on) follows the same procedure, with the previous reference jet removed from the matching collection. Calibrations are then derived. The reciprocal of the response vs. $\ptsup{{\mathrm{L1}}}$ is plotted for each \abseta bin and correction curves are fitted to them (see Fig. \ref{fig:detector_jecs_corr_curves}). Once tuned such that the fit captures the low-\pt spike and high-\pt plateau, closure tests are conducted as the final step. The ntuples are remade with JECs and then matched with the reference jets to check that the calibrations have been properly applied. Plots such as Fig. \ref{fig:detector_jecs_scatter_BE} are then passed to the Trigger Studies Group to check over and continue the chain of trigger corrections and object calibrations.

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{./figures/jecs//corrCurveBarrel.pdf}
        \caption{$0.435 < \abseta < 0.783$ (Barrel)}
        \label{fig:detector_jecs_corr_curve_Barrel}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{./figures/jecs/corrCurveHF.pdf}
        \caption{$4.191 < \abseta < 5.191$ (HF)}
        \label{fig:detector_jecs_corr_curve_HF}
    \end{subfigure}
\caption[Examples of correction curves used to calibrate the jet energies in two \abseta bins]{Examples of correction curves used to calibrate the jet energies in two \abseta bins. The response is plotted against the \pt of the Level-1 jet and a complex function produces a fit. These plots are from the jet energy corrections performed on 2018 QCD Monte Carlo.}
\label{fig:detector_jecs_corr_curves}
\end{figure}

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{./figures/jecs/scatterPlotBeforeBE.png}
        \caption{Before corrections}
        \label{fig:detector_jecs_scatter_before_BE}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{./figures/jecs/scatterPlotAfterBE.png}
        \caption{After corrections}
        \label{fig:detector_jecs_scatter_after_BE}
    \end{subfigure}
\caption[The energies of matched pairs of jets in the entire barrel and end cap, before and after jet energy corrections have been applied]{The energies of matched pairs of jets in the entire barrel and end cap, before and after jet energy corrections have been applied. After calibrations, the distribution is much more symmetrical. An equivalent plot using jets from LHC data is expected to look similar after applying these calibrations.}
\label{fig:detector_jecs_scatter_BE}
\end{figure}

%=========================================================
